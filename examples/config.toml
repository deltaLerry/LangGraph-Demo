[app]
# 默认点子（CLI/环境变量可覆盖）
# 150章×5000字长跑推荐：用 --idea-file 点子包输入；这里留空占位即可
idea = ""

# 输出根目录
output_base = "outputs"

# 阶段：用于归档/持久化记录（例如 stage1 / stage2 / stage3）
stage = "stage1"

# 写作/审核时注入“最近章节记忆”的数量（只注入梗概 summary）
memory_recent_k = 3

# 是否允许注入“未审核通过”的章节记忆（默认 false，避免污染后续写作/审稿）
# include_unapproved_memories = false

# 用户文风覆盖（本次运行注入 writer/editor；不自动写入 canon/style.md）
# style_override = ""

# 段落/结构规则（例如：每段<=120字；对话占比>40%；不要总结句）
# paragraph_rules = ""

# editor 稳定性参数
# - editor_min_issues：主编拒稿时至少给出多少条 issues（默认2）
# - editor_retry_on_invalid：主编 JSON 不合法/issue过少时自动修复重试次数（默认1）
# editor_min_issues = 2
# editor_retry_on_invalid = 1
editor_min_issues = 2
editor_retry_on_invalid = 1

# LLM 调用重试（抗网络/限流抖动；适合无人值守批量生成）
llm_max_attempts = 3
llm_retry_base_sleep_s = 10.0

# Arc summaries（中程记忆）：每 N 章生成一个“分卷摘要”，写作/审稿时注入最近 K 个，用于 150 章规模控制矛盾与 token
enable_arc_summary = true
arc_every_n = 10
arc_recent_k = 2

# 无人值守：自动应用沉淀建议（默认 off）
# - off：不自动应用（人工 review→确认→应用）
# - safe：只自动应用低风险补丁（world.notes/style.md + materials 幂等追加）
auto_apply_updates = "safe"

# 运行模式：
# - "template"：强制模板（用于纯工作流验证，不走LLM）
# - "llm"：强制LLM（未配置LLM时将报错）
# - "auto"：有LLM就用LLM，否则用模板（默认）
llm_mode = "auto"

# 是否开启 debug：输出 debug.jsonl 运行日志 + call_graph.md 节点调用图
debug = true

[generation]
# 目标字数（每章）
target_words = 5000

# 章节数
chapters = 150

# 每章最多返工次数（不含首稿）
max_rewrites = 1

[planner]
# 策划任务槽位：根据“当前启用的上游 agent”决定拆分哪些任务、派给谁。
# 你后续进入 3.0（并行架构师/角色导演/编剧）时，就在这里增删/调整任务即可。
tasks = [
  { task_name = "世界观设定", executor = "架构师", hint = "构建世界背景、规则、势力与核心冲突，要求可用于写作约束（Canon）" },
  { task_name = "核心角色", executor = "角色导演", hint = "产出主要人物卡：性格、动机、能力、禁忌、关系网" },
  { task_name = "主线脉络", executor = "编剧", hint = "给出主线推进的关键节点与前期节奏安排" },
  { task_name = "开篇基调", executor = "策划", hint = "明确文风/视角/节奏/情绪基调，给写手可执行的风格约束" },
]

## LLM 配置建议放在 .env（只包含 LLM_*，避免与本文件重复）
## 示例见：examples/env.example 或 examples/env_150x5000.example