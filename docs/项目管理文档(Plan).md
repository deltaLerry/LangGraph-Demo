### LangGraph 写作助手（半自动 Human-in-the-loop）项目管理文档（计划与治理）

### 1. 项目定位与治理原则
- **质量优先**：稳定性/一致性 > 效率/规模。
- **总编拍板**：关键门禁节点必须由总编决策；系统只做整理与建议。
- **冻结治理**：冻结材料包为写作期唯一真值；冻结后修改只能走变更提案。
- **可追溯治理**：产物、决策、提案、迁移与日志必须可复盘与审计。

### 2. 交付物（本期必须）
- **文档与模板**
  - 冻结材料包字段契约（Canon/Planning/Execution/Risk）
  - 锚点（Anchors）规范与 ID 命名规则
  - 材料包修改指令单模板
  - 章节重写指令单模板（含 anchors 引用）
  - 变更提案模板（含影响评估与迁移计划）
  - 冻结 DoD 检查表、章节验收卡字段清单
- **工作流能力（CLI）**
  - 材料包：Draft→Loop→Human Gate→Freeze（门禁生效）
  - 章节：每章 Writer→Editor→Human Gate→Deposit（门禁生效）
  - 变更提案：Draft→Advisor→Human→Migration→Re-Freeze
- **存储与日志**
  - 项目隔离目录结构落地
  - 双日志：full + index + payload 外置
  - run 快照归档（stages/runs）
- **顾问 Agent**
  - 可问答 + 一致性审计 + 指令单草案输出

### 3. 里程碑与范围拆分（建议）

### M0 规格冻结（1）
- **目标**：字段契约、目录规范、日志 schema、门禁动作枚举定稿（不再反复改名）。
- **验收**：
  - 三份文档定稿（PRD/TechSpec/Plan）
  - 模板定稿（指令单/提案/审阅卡字段）

### M1 材料包链路（2）
- **目标**：可生成材料包 drafts；可收敛 review；可总编冻结并生成 frozen；无 frozen 禁止写作。
- **验收**：
  - 冻结 DoD 能阻止“未完备材料包”进入写作
  - 冻结版本可被 run_meta 引用并快照化

### M2 章节链路（3）
- **目标**：每章必经人审 gate；支持重写多轮；Accept 后才写入 memory 与归档。
- **验收**：
  - 无 `001.human_review.json` 不允许进入第 2 章
  - Waive/Skip 可关闭 issues 且有原因记录

### M3 变更提案链路（4）
- **目标**：冻结后任何修改必须提案；提案审批后产生新 frozen；迁移过程可追溯。
- **验收**：
  - 章节中触发 escalate 会暂停章节流
  - 提案目录包含 advisor_review/human_decision/migration_log/refreeze 记录

### M4 可观测性与可检索（5）
- **目标**：full/index 双日志可用；可快速按项目/章节/状态检索卡点与失败点；可生成章级/运行级 summary。
- **验收**：
  - index 可支持实时查询（过滤：blocked/error/需要人审）
  - full 可追溯到完整 payload

### 4. 验收标准（Definition of Done）
- **门禁有效**
  - 无冻结材料包无法开始写
  - 每章无总编决策无法继续/沉淀
  - 冻结后修改无法绕过提案
- **一致性可控**
  - anchors 可引用；审计能发现 glossary 漂移与 Canon 冲突
- **可追溯**
  - 任一章节可追踪：使用的 frozen 版本、审稿 issues、总编决策、提案链路、归档快照
- **可恢复**
  - 中断后可从落盘状态继续，不丢上下文
- **项目隔离**
  - 两个项目目录互不影响；不会读写错目录

### 5. 风险清单与对策
- **流程自锁（永远冻不了/永远过不了）**
  - 对策：blocker 机制 + 指令单验收标准 + 顾问给出“最小可冻方案”（仍需总编拍板）
- **总编负担过重（每章必看）**
  - 对策：审阅卡 digest 默认 + 全文按需展开 + 顾问预审 + 指令单草案
- **材料漂移/术语漂移**
  - 对策：glossary/anchors 强制；漂移触发 `glossary_drift` 事件并在审阅卡高亮
- **变更提案频繁导致停滞**
  - 对策：提案必须含影响评估与迁移计划；可进入 backlog 由总编择机处理

### 6. 协作与工作方式（建议）
- **总编工作节奏**
  - 材料包：集中评审（一次看 digest，必要时展开全文），用指令单驱动迭代
  - 章节：每章固定看“审阅卡”，通过/重写/提案三选一
- **顾问使用方式**
  - 任何“是否冲突/是否需要提案/怎么改更稳”的问题优先问顾问
  - 顾问输出必须引用 anchors，并区分“硬约束冲突”与“写法建议”


